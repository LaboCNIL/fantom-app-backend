# ===================================================================
# Spring Boot configuration.
#
# This configuration will be overridden by the Spring profile you use,
# for example application-dev.yml if you use the "dev" profile.
#
# ===================================================================

# ===================================================================
# Standard Spring Boot properties.
# Full reference is available at:
# http://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html
# ===================================================================
logging:
  file:
    path: /tmp/logs
    maxFileSize: 10MB
    maxHistory: 60
    totalSizeCap: 20GB
    logPattern: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36}.%M\\(%line\\) - %msg%n"
  level:
    root: WARN
    com.aot.fantomeapp: WARN
    sql: WARN
    sql_params: WARN
#Metrics related configurations
management:
  prometheus:
    metrics:
      export:
        enabled: true
  endpoint:
    web.exposure.include: prometheus
    metrics.enabled: true
    prometheus.enabled: true
    health:
      probes:
        enabled: true
  endpoints.web.exposure.include: "*"
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true

spring:
  docker:
    compose:
      enabled: false
  application:
    name: 'fantome-app'
  messages:
    basename: i18n/messages
  main:
    allow-bean-definition-overriding: true
  output:
    ansi:
      console-available: true

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI}
          jwk-set-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI}
      client:
        registration:
          keycloak:
            client-id: fantome-app
            authorization-grant-type: authorization_code
            scope: openid_email_profile
        provider:
          keycloak:
            user-name-attribute: preferred_username

  jpa:
    show-sql: false
    properties:
      hibernate:
        format_sql: true
    hibernate:
      ddl-auto: none
  flyway:
    enabled: true
    locations:
      - classpath:/db/migration
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
  thymeleaf:
    prefix: classpath:/templates/

server:
  servlet:
    context-path: /api
    session:
      cookie:
        http-only: true

app:
  version: "${project.version}"
  
  sso:
    issuer: "${spring.security.oauth2.resourceserver.jwt.issuer-uri}"
    clientID: "${spring.security.oauth2.client.registration.keycloak.client-id}"

  security:
    unsecure:
      paths: /actuator/**,/actuator,/config,/public/**
    cors: 
      allowed-origins: #via ENV
